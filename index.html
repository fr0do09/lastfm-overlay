<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Last.fm Widget&lt;/title&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="stylesheet" href="tracks.css"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: transparent;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: Arial, sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;lastfm-tracks<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>user="fardeen09mir"</p>
<p class="p1"><span class="Apple-converted-space">        </span>apikey="048120c6666f3ea0f1b2bf28583f98d1"</p>
<p class="p1"><span class="Apple-converted-space">        </span>tracks="10"</p>
<p class="p1"><span class="Apple-converted-space">        </span>updates="0"</p>
<p class="p1"><span class="Apple-converted-space">        </span>interval="60"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/lastfm-tracks&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>class LastFMTracks extends HTMLElement {</p>
<p class="p1"><span class="Apple-converted-space">            </span>static get observedAttributes() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>return ["user", "apikey", "tracks", "interval", "updates"];</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>constructor() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>super();</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.attachShadow({ mode: "open" });</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.shadowRoot.innerHTML = `&lt;style&gt;@import "tracks.css";&lt;/style&gt;&lt;div class="track-list"&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>connectedCallback() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.user = this.getAttribute("user");</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.apikey = this.getAttribute("apikey");</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.trackCount = parseInt(this.getAttribute("tracks") || "5");</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.updateCount = parseInt(this.getAttribute("updates") || "0");</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.interval = parseInt(this.getAttribute("interval") || "60");</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.fetchTracks();</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.startUpdates();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>attributeChangedCallback(name, oldValue, newValue) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (name === "user") this.user = newValue;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (name === "apikey") this.apikey = newValue;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (name === "tracks") this.trackCount = parseInt(newValue);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (name === "interval") this.interval = parseInt(newValue);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (name === "updates") this.updateCount = parseInt(newValue);</p>
<p class="p1"><span class="Apple-converted-space">                </span>this.fetchTracks();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>disconnectedCallback() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>clearInterval(this.updateTimer);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>startUpdates() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (this.interval &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>let count = 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>this.updateTimer = setInterval(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (this.updateCount === 0 || count &lt; this.updateCount) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>this.fetchTracks();</p>
<p class="p1"><span class="Apple-converted-space">                            </span>count++;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}, this.interval * 1000);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>async fetchTracks() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!this.user || !this.apikey) return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const url = `https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&amp;user=${this.user}&amp;api_key=${this.apikey}&amp;format=json&amp;limit=${this.trackCount}`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const res = await fetch(url);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const data = await res.json();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>this.renderTracks(data.recenttracks.track);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (err) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error("Error fetching tracks:", err);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>renderTracks(tracks) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const container = this.shadowRoot.querySelector(".track-list");</p>
<p class="p1"><span class="Apple-converted-space">                </span>container.innerHTML = "";</p>
<p class="p1"><span class="Apple-converted-space">                </span>tracks.forEach(track =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const trackDiv = document.createElement("div");</p>
<p class="p1"><span class="Apple-converted-space">                    </span>trackDiv.className = "track";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const img = track.image.find(img =&gt; img.size === "large")["#text"] || "";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const artist = track.artist["#text"];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const name = track.name;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const album = track.album["#text"];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const nowPlaying = track["@attr"] &amp;&amp; track["@attr"].nowplaying;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>trackDiv.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;img src="${img}" alt="${artist}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="track-info"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="track-name"&gt;${name}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="track-artist"&gt;${artist}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="track-album"&gt;${album}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>${nowPlaying ? '&lt;div class="now-playing"&gt;Now Playing&lt;/div&gt;' : ""}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>container.appendChild(trackDiv);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>customElements.define("lastfm-tracks", LastFMTracks);</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
